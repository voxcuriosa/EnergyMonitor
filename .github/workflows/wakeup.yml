name: Wake Up App

on:
  schedule:
    # Run every hour to keep the app warm
    - cron: '0 * * * *'
  workflow_dispatch: # Allows manual triggering from Actions tab

# Prevent multiple wakeup runs from overlapping
concurrency:
  group: wakeup-streamlit
  cancel-in-progress: true

jobs:
  wakeup:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Small Random Delay
        run: |
          # Sleep for a random time between 1 and 300 seconds (5 minutes)
          SLEEP_TIME=$((1 + RANDOM % 300))
          echo "Sleeping for $SLEEP_TIME seconds..."
          sleep $SLEEP_TIME

      - name: Wake up Streamlit App
        run: |
          # Use -L to follow redirects and -S to show errors
          curl -L -S -f --max-time 30 https://cbvenergy.streamlit.app/ || echo "App might be booting..."
          echo "Ping sent to Streamlit App"

